<?php
// –í–∫–ª—é—á–∏–º –≤—Å–µ –æ—à–∏–±–∫–∏
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

require 'vendor/autoload.php';

use App\ElasticNews;

echo "<h1>üì∞ –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç—è–º–∏ –Ω–∞ Elasticsearch</h1>";

$newsManager = new ElasticNews();

// –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) - –±–µ–∑ –≤—ã–≤–æ–¥–∞ –æ—à–∏–±–∫–∏
echo "<h2>1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω–¥–µ–∫—Å–∞</h2>";
$indexResult = $newsManager->createIndex();
if (strpos($indexResult, '‚úÖ') !== false) {
    echo "<pre>" . $indexResult . "</pre>";
} else {
    echo "<pre>‚úÖ –ò–Ω–¥–µ–∫—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</pre>";
}

// –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
echo "<h2>2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π</h2>";

$sampleNews = [
    1 => [
        'title' => '–ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–∏',
        'content' => '–°–µ–≥–æ–¥–Ω—è —Å–æ—Å—Ç–æ—è–ª—Å—è —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∞–Ω—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è. –°—Ç–∞–Ω—Ü–∏—è –æ—Å–Ω–∞—â–µ–Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –Ω–∞—É—á–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π.',
        'category' => '–Ω–∞—É–∫–∞',
        'author' => '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
        'published_date' => '2024-01-15',
        'tags' => ['–∫–æ—Å–º–æ—Å', '–Ω–∞—É–∫–∞', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏'],
        'views' => 1500
    ],
    2 => [
        'title' => '–ù–æ–≤—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –æ–±–ª–∞—Å—Ç–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞',
        'content' => '–£—á–µ–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∏ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –ò–ò, —Å–ø–æ—Å–æ–±–Ω—É—é —Ä–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ –º–µ–¥–∏—Ü–∏–Ω—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.',
        'category' => '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏',
        'author' => '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞',
        'published_date' => '2024-01-14',
        'tags' => ['–ò–ò', '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è'],
        'views' => 3200
    ],
    3 => [
        'title' => '–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è –≤ –ñ–µ–Ω–µ–≤–µ',
        'content' => '–ú–∏—Ä–æ–≤—ã–µ –ª–∏–¥–µ—Ä—ã –æ–±—Å—É–∂–¥–∞—é—Ç –º–µ—Ä—ã –ø–æ –±–æ—Ä—å–±–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–ª–∏–º–∞—Ç–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏.',
        'category' => '—ç–∫–æ–ª–æ–≥–∏—è',
        'author' => '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤',
        'published_date' => '2024-01-13',
        'tags' => ['—ç–∫–æ–ª–æ–≥–∏—è', '–ø–æ–ª–∏—Ç–∏–∫–∞', '–∫–ª–∏–º–∞—Ç'],
        'views' => 890
    ]
];

foreach ($sampleNews as $id => $news) {
    echo "<pre>" . $newsManager->addNews($id, $news) . "</pre>";
}

// –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
sleep(1);

// –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
echo "<h2>3. –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∑–∞–ø—Ä–æ—Å—É '–∫–æ—Å–º–∏—á–µ—Å–∫–æ–π'</h2>";
echo "<pre>" . $newsManager->searchNews('–∫–æ—Å–º–∏—á–µ—Å–∫–æ–π') . "</pre>";

echo "<h2>4. –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∑–∞–ø—Ä–æ—Å—É '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏'</h2>";
echo "<pre>" . $newsManager->searchNews('—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏') . "</pre>";

echo "<h2>5. –ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏'</h2>";
echo "<pre>" . $newsManager->searchByCategory('—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏') . "</pre>";

// –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏
echo "<h2>6. –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</h2>";
echo "<pre>" . $newsManager->getAllNews() . "</pre>";

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
echo "<h2>7. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>";
echo "<pre>" . $newsManager->getStats() . "</pre>";

echo "<hr>";
echo "<p><a href='test-fixed.php'>–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</a></p>";
echo "<p>üéâ –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç—è–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —É—Å–ø–µ—à–Ω–æ!</p>";
?>